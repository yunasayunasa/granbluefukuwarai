# Odyssey Engine UI/VSL改修 実装プラン

**作成日**: 2025-11-26  
**プロジェクト**: Odyssey Engine - iPad向け2Dゲームエンジン  
**目標**: Unity風のWebベースゲームエディタの完成度向上

## 📊 現状分析

### ✅ 完了済み項目（UI_FIX_PROGRESS.mdより）

1. プロジェクトパネル（アセットブラウザ）の復旧
2. アセット一覧のスタイル修正
3. ボタンのタッチ対応
4. インスペクタパネルの復旧
5. インスペクタロックボタンの実装
6. プレイモード切り替えトグルの復活
7. ツールバーの表示修正
8. ツールチップの追加
9. GizmoManagerの機能追加
10. 引継ぎドキュメント作成

### ⚠️ 未解決の課題

1. **【最優先】VSLエディタ（ビジュアルスクリプティング）のノードマップが表示されない**
   - 問題: イベントエディタを開いてもVSLノードのキャンバスが表示されない
   - 原因: `style.css`にVSLエディタ関連のCSSスタイルが完全に欠落している
   - 影響: ゲームロジックを組むための最重要機能が使用不可

2. **アセット追加機能の未実装**
   - ドラッグ&ドロップ機能がない
   - インポートボタンがない

- ピン（入力/出力コネクタ）のデザイン
- 接続線（SVG）のスタイル
- ツールバーとノードリストのレイアウト
- iPad対応のタッチフレンドリーなサイズ設定

**確認方法**:

1. デバッグモードで起動
2. オブジェクトを選択してイベントエディタを開く
3. VSLキャンバスが表示され、ノードを配置できることを確認
4. ノード間の接続線が描画されることを確認

#### タスク 1-2: エディタUIの動作確認とバグ修正

- VSLノードリストが正しく表示されるか確認
- ノードのドラッグ&ドロップが機能するか確認
- ピンのクリックによる接続作成が機能するか確認
- ノードパラメータの編集UIが表示されるか確認

### 🟡 高優先（P1）- ユーザビリティの向上

#### タスク 2-1: Undo/Redoのデバッグ

1. `EditorCommandManager.js`のコマンド記録ロジックを確認
2. コンソールログでコマンドスタックの状態を追跡
3. UIボタンのイベントリスナーが正しく接続されているか確認
4. エディタプラグインとの連携を確認

#### タスク 2-2: タブ切り替え機能の修正

1. `EditorUI.js`のタブ切り替えロジックを確認
2. Animationタブのイベントリスナーを修正
3. タブコンテンツの表示/非表示ロジックを確認

### 🟢 中優先（P2）- 機能追加

#### タスク 3-1: アセットインポート機能の実装

1. ファイルドラッグ&ドロップ対応
   - ドロップゾーンの作成
   - ファイル受け入れ処理
2. 「+」ボタンでのファイル選択ダイアログ
3. アセット登録とプレビュー生成

#### タスク 3-2: UIガイドの作成

1. 各パネルの使い方を説明するツールチップ改善
2. ヘルプモーダルのコンテンツ充実

## 📝 技術仕様メモ

### VSLエディタの構造

- **HTML**: `index.html` 236-268行 - イベントエディタモーダル
- **JavaScript**: `EditorUI.js` - VSLエディタのロジック
  - `populateVslCanvas()` - ノードのレンダリング
  - `buildNodeContent()` - ノードUIの構築
  - `drawConnections()` - 接続線の描画
  - `onPinClicked()` - ピンクリックハンドラ
- **データ**: オブジェクトの`events`データプロパティに保存

### エディタモードの起動

- URL: `?debug=true` パラメータ
- `EditorUI.js`で強制的にデバッグモードを有効化済み

### 重要ファイル

- `src/editor/EditorUI.js` - UIロジックの中核（110KB）
- `src/plugins/EditorPlugin.js` - エディタ機能の統括（145KB）
- `src/editor/GizmoManager.js` - ギズモ操作（11KB）
- `index.html` - UI構造（13KB）
- `style.css` - スタイル定義（12KB）

## 🔍 確認事項（ユーザーへの質問）

以下の点について確認が必要です：

1. **VSLエディタの開き方**
   - 現在、どのような手順でVSLエディタを開こうとしていますか？
   - オブジェクトを選択してからどのボタンを押していますか？

2. **表示されない症状の詳細**
   - モーダルウィンドウ自体は開きますか？
   - 開くが中身（ノード配置エリア）が見えないのでしょうか？
   - それともモーダル自体が開かないのでしょうか？

3. **コンソールエラー**
   - ブラウザの開発者ツール（F12）でコンソールにエラーが出ていますか？
   - もし出ている場合、エラーメッセージを教えてください

4. **テスト環境**
   - 現在テストしているブラウザは何ですか？（Chrome/Safari/Firefox等）
   - PCでテストしていますか、それともiPadですか？

## 📅 実装スケジュール案

### フェーズ1: 緊急修正（1-2時間）

- [ ] VSLエディタのCSS実装
- [ ] 基本的な表示確認

### フェーズ2: 動作検証（1時間）

- [ ] VSLノードの配置テスト
- [ ] 接続作成のテスト
- [ ] パラメータ編集のテスト

### フェーズ3: バグ修正（2-3時間）

- [ ] Undo/Redoのデバッグ
- [ ] タブ切り替えの修正

### フェーズ4: 機能追加（3-4時間）

- [ ] アセットインポート機能
- [ ] UIガイド作成

## 🎨 デザイン指針

- **iPad最適化**: 全てのUI要素は最小32px×32pxのタッチターゲット
- **ダークテーマ**: Unity風の統一された配色
- **視覚的フィードバック**: ホバー、選択、ドラッグ状態を明確に表示
- **レスポンシブ**: 画面サイズに応じた適切なレイアウト

---

**次のステップ**: ユーザーからの確認事項への回答を待って、VSLエディタのCSS実装を開始します。
